@page "/itasset/hardware/cruc/{CRUCMode}"
@page "/itasset/hardware/cruc/{CRUCMode}/{id:int}"

@* @rendermode InteractiveAuto*@
@inject IDialogService MudDiagSvc
@inherits CRUCPageBase<ITAsset>

@if (CurrentObject != null && CurrentEditContext != null)
{
    <EditForm EditContext="CurrentEditContext" OnValidSubmit="SaveDummy" OnInvalidSubmit="SaveDummy" >
        <DataAnnotationsValidator />
        <MudPaper Class="px-4 py-3 rounded" Width="100%" Elevation="0" Square="true" Style="background-color:var(--pru-cyan-tw-50); border: solid 1px var(--pru-cyan-tw-400)">
            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                <div style="color:var(--pru-cyan-default); font-size:28px;">
                    <span style="font-weight:800">@HeaderTitle</span>
                    <span style="font-weight:400"> | Hardware</span>
                    @if (CRUCMode == CRUDCModes.READ)
                    {
                        <MudChip Size="Size.Small" Color="Color.Success" Class=@($"status-chip-tiny") T="string" Style="margin-top:-5px">View</MudChip>
                    }
                    else if (CRUCMode == CRUDCModes.UPDATE)
                    {
                        <MudChip Size="Size.Small" Color="Color.Info" Class=@($"status-chip-tiny") T="string">Update</MudChip>
                    }
                    else if (CRUCMode == CRUDCModes.CREATE)
                    {
                        <MudChip Size="Size.Small" Color="Color.Info" Class=@($"status-chip-tiny") T="string">New</MudChip>
                    }
                    else if (CRUCMode == CRUDCModes.CLONE)
                    {
                        <MudChip Size="Size.Small" Color="Color.Info" Class=@($"status-chip-tiny") T="string">New (Clone)</MudChip>
                    }
                </div>
                <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center" Justify="Justify.FlexEnd">
                    @if (!IsViewMode)
                    {
                        <MudButton Variant="Variant.Filled" Size="Size.Small" DropShadow="false" Color="Color.Primary" StartIcon="material-symbols-rounded/save_as" Class="pru-btn-base"
                                   OnClick="@(() => Save())">Save</MudButton>
                        <MudButton Variant="Variant.Filled" Size="Size.Small" DropShadow="false" Color="Color.Primary" StartIcon="material-symbols-rounded/save" Class="pru-btn-base"
                                   OnClick="@(() => Save(true))">Save & Close</MudButton>
                        <MudButton Variant="Variant.Filled" Size="Size.Small" DropShadow="false" Color="Color.Secondary" StartIcon="material-symbols-rounded/cancel" Class="pru-btn-base"
                                   OnClick="Cancel">Cancel</MudButton>
                    }
                    else
                    {
                        <MudButton Variant="Variant.Filled" Size="Size.Small" DropShadow="false" Color="Color.Default" StartIcon="material-symbols-rounded/close" OnClick="Cancel">Close</MudButton>
                    }
                </MudStack>
            </MudStack>
        </MudPaper>
        <MudTabs Class="pru-mud-tab cruc-pg mt-3" Elevation="0">
            <MudTabPanel Text="Main" Icon="material-symbols-rounded/home" Class="pru-mud-tab-panel" Style="min-width:120px">
                <MudPaper Class="px-4 pt-2 pb-5 overflow-y-auto" Height="calc(100vh - 210px)" Width="100%" Elevation="0" Style="position:relative">
                    <MudGrid Spacing="2" Justify="Justify.SpaceEvenly">
                        <MudItem xs="4">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered" Required="true"
                                          Label="Desc" Placeholder="Desc" InputId="ObjectName"
                                          @bind-Value=CurrentObject!.ObjectName For="@(() => CurrentObject.ObjectName)" MaxLength="255" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered" Required="false"
                                          Label="System Asset Name" Placeholder="System Asset Name"
                                          @bind-Value=CurrentObject!.AssetName For="@(() => CurrentObject.AssetName)" MaxLength="255" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="2">
                            <MudTextField Readonly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered" Required="true" FullWidth="true"
                                            Label="Asset ID" Placeholder="Asset ID" InputId="ObjectCode"
                                            @bind-Value=CurrentObject!.ObjectCode For="@(() => CurrentObject.ObjectCode)" OnlyValidateIfDirty="true" MaxLength="80" />
                        </MudItem>
                        <MudItem xs="2">
                            <MudSelect ReadOnly="@IsViewMode" Clearable="true" Class="pru-mud-form-field bordered pru-ui-select" Required="true" FullWidth="true"
                                       Label="Asset Type" Placeholder="Select asset type"
                                       Value=CurrentObject!.AssetType For="@(() => CurrentObject.AssetType)" ValueChanged="OnAssetTypeChanged" InputId="AssetType" T="string" OnlyValidateIfDirty="true">
                                @foreach (DropdownSelectItem assetType in _assetTypeList)
                                {
                                    <MudSelectItem Value=@assetType.Key>@assetType.Value</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="4">
                            <MudSelect ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-select" PopoverClass="pru-ui-select-popover" FullWidth="true"
                                       Label="Category" InputId="CategoryCode"
                                       T="string" Value=CurrentObject!.CategoryCode ValueChanged="OnCategoryChanged" For="@(() => CurrentObject.CategoryCode)" OnlyValidateIfDirty="true" Disabled=@(string.IsNullOrEmpty(CurrentObject!.AssetType))>
                                @foreach (DropdownSelectItem ctg in _categoryList)
                                {
                                    <MudSelectItem Value=@ctg.Key>@ctg.Value</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="4">
                            <MudSelect ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-select" PopoverClass="pru-ui-select-popover"
                                       Label="Sub-Category" Placeholder="Select a sub-category" 
                                        @bind-Value=CurrentObject!.SubCategory For="@(() => CurrentObject.SubCategory)" OnlyValidateIfDirty="true"
                                        Disabled=@(string.IsNullOrEmpty(CurrentObject!.CategoryCode))>
                                @foreach (DropdownSelectItem ctg in _subCategoryList)
                                {
                                    <MudSelectItem Value=@ctg.Value>@ctg.Value</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="2">
                            @* <MudChip T="string" Size="Size.Medium" Class="@(!string.IsNullOrEmpty(@CurrentObject!.AssetState) ? _stateCssClassList[@CurrentObject.AssetState!] : "status-chip-default-dark")">
                                @CurrentObject!.AssetStateText
                            </MudChip>
                            @if (!IsViewMode && CurrentObject!.Id > 0)
                            {
                                <MudTooltip Text="Update Asset State">
                                    <MudIconButton Icon="@Icons.Material.Rounded.PlayCircle" Size="Size.Small" OnClick="OnAssetStateClicked" />
                                </MudTooltip>
                            } *@
                            <MudSelect ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-select" PopoverClass="pru-ui-select-popover" Required="true"
                                       Label="Asset State"
                                       T="string" @bind-Value=CurrentObject!.AssetState For="@(() => CurrentObject.AssetState)" OnlyValidateIfDirty="true">
                                @foreach (DropdownSelectItem assetState in _assetStateList)
                                {
                                    <MudSelectItem Value=@assetState.Key>@assetState.Value</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="2">
                            @* <MudChip T="string" Size="Size.Medium" Class="@(!string.IsNullOrEmpty(@CurrentObject!.LifeCycleStatus) ? _statusCssClassList[@CurrentObject.LifeCycleStatus!] : "status-chip-default-dark")">
                                @CurrentObject!.LifeCycleStatusText
                            </MudChip>
                            @if (!IsViewMode && CurrentObject!.Id > 0)
                            {
                                <MudTooltip Text="Update Asset Life Cycle">
                                    <MudIconButton Icon="@Icons.Material.Rounded.PlayCircle" Size="Size.Small" OnClick="OnLifeCycleStatusClicked" />
                                </MudTooltip>
                            } *@
                            <MudSelect ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-select" PopoverClass="pru-ui-select-popover" Required="true"
                                       Label="Life Cycle Status"
                                       T="string" @bind-Value=CurrentObject!.LifeCycleStatus For="@(() => CurrentObject.LifeCycleStatus)" OnlyValidateIfDirty="true">
                                @foreach (DropdownSelectItem lifeCycleStatus in _assetLifeCycleList)
                                {
                                    <MudSelectItem Value=@lifeCycleStatus.Key>@lifeCycleStatus.Value</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="6">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered" Required="true"
                                          Label="Product Name" MaxLength="255"
                                          @bind-Value=CurrentObject!.ProductName For="@(() => CurrentObject.ProductName)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          Label="Manufacturer/Brand" MaxLength="255"
                                          @bind-Value=CurrentObject!.Manufacturer For="@(() => CurrentObject.Manufacturer)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          Label="Serial No." MaxLength="50"
                                          @bind-Value=CurrentObject!.SerialNo For="@(() => CurrentObject.SerialNo)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="12">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          Lines=4 MaxLength="1000" MaxLines="25"
                                          Label="Spec Summary" Placeholder="Technical specification summary..."
                                          @bind-Value=CurrentObject!.SpecSummary For="@(() => CurrentObject!.SpecSummary)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          Label="Svc Desk Ticket#" MaxLength="50"
                                          @bind-Value=CurrentObject!.SvcDeskTicketNo For="@(() => CurrentObject.SvcDeskTicketNo)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudAutocomplete Readonly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-autocomplete" FullWidth="true"
                                             CoerceText="true" CoerceValue="true" SearchFunc="SearchRequestor"
                                             Label="Requestor" T="DropdownSelectItem" ToStringFunc="@(e => e == null ? null : $"{e.Value} ({e.Key})")"
                                             Value="_requestor" ValueChanged="OnRequestorValueChanged" />
                            @* <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          AdornmentIcon="material-symbols-rounded/assignment_ind" Adornment="Adornment.Start" AdornmentColor=@Color.Primary
                                          Label="Requestor Staff ID" MaxLength="50" 
                                          @bind-Value=CurrentObject!.RequestUserID For="@(() => CurrentObject.RequestUserID)" OnlyValidateIfDirty="true" /> *@
                        </MudItem>
                        @* <MudItem xs="3">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          AdornmentIcon="material-symbols-rounded/person" Adornment="Adornment.Start" AdornmentColor=@Color.Primary
                                          Label="Requested By" Placeholder="Full name of requestor" MaxLength="150" 
                                          @bind-Value=CurrentObject!.RequestUserName For="@(() => CurrentObject.RequestUserName)" OnlyValidateIfDirty="true" />
                        </MudItem> *@
                        <MudItem xs="3">
                            <MudAutocomplete Readonly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-autocomplete" FullWidth="true"
                                             CoerceText="true" CoerceValue="true" SearchFunc="SearchCurrentUser"
                                             Label="Current User" T="DropdownSelectItem" ToStringFunc="@(e => e == null ? null : $"{e.Value} ({e.Key})")"
                                             Value="_currentUser" ValueChanged="OnCurrentUserValueChanged" />
                        </MudItem>
                        @* <MudItem xs="3">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          AdornmentIcon="material-symbols-rounded/assignment_ind" Adornment="Adornment.Start" AdornmentColor=@Color.Primary
                                          Label="Employee ID" MaxLength="25" 
                                          @bind-Value=CurrentObject!.CurrentUserID For="@(() => CurrentObject.CurrentUserID)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          AdornmentIcon="material-symbols-rounded/person" Adornment="Adornment.Start" AdornmentColor=@Color.Primary
                                          Label="Employee Name" MaxLength="25" 
                                          @bind-Value=CurrentObject!.CurrentUserName For="@(() => CurrentObject.CurrentUserName)" OnlyValidateIfDirty="true" />
                        </MudItem> *@
                        <MudItem xs="3">
                            <MudAutocomplete Readonly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-autocomplete" FullWidth="true"
                                             CoerceText="true" CoerceValue="true" SearchFunc="SearchFunc"
                                             Label="Function" T="string"
                                             @bind-Value=CurrentObject!.CurrentUserFunc For="@(() => CurrentObject!.CurrentUserFunc)" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudAutocomplete Readonly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-autocomplete" FullWidth="true"
                                             CoerceText="true" CoerceValue="true" SearchFunc="SearchDept"
                                             Label="Department" T="string"
                                             @bind-Value=CurrentObject.CurrentUserDept For="@(() => CurrentObject.CurrentUserDept)" />
                        </MudItem>
                        @* ================================================================================================================================== *@
                        <MudItem xs="3">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          Label="PR#" MaxLength="25"
                                          @bind-Value=CurrentObject!.PRRefNo For="@(() => CurrentObject.PRRefNo)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          Label="PO#" MaxLength="25"
                                          @bind-Value=CurrentObject!.PORefNo For="@(() => CurrentObject.PORefNo)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          Label="Quote #" MaxLength="25"
                                          @bind-Value=CurrentObject!.QuoteRefNo For="@(() => CurrentObject.QuoteRefNo)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          Label="Invoice #" MaxLength="25"
                                          @bind-Value=CurrentObject!.InvoiceRefNo For="@(() => CurrentObject.InvoiceRefNo)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudDatePicker ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-datepicker" Editable="true"
                                           AdornmentIcon="material-symbols-rounded/calendar_month" AdornmentColor=@Color.Primary
                                           Label="Purchased Date"
                                           @bind-Date=@CurrentObject.PurchaseDate DateFormat="dd-MMM-yyyy" For="@(() => CurrentObject.PurchaseDate)" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudNumericField ReadOnly=@IsViewMode Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered" Culture="@CultureInfo.GetCultureInfo("en-US")" HideSpinButtons="true" Step=".1M" Format="#,##0.00" Min="0"
                                             AdornmentIcon="material-symbols-rounded/attach_money" Adornment="Adornment.Start" AdornmentColor=@Color.Primary
                                             Label="Purchased Cost"
                                             @bind-Value=CurrentObject!.PurchaseCost For="@(() => CurrentObject.PurchaseCost)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudNumericField ReadOnly=@IsViewMode Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered" Culture="@CultureInfo.GetCultureInfo("en-US")" HideSpinButtons="true" Step=".1M" Format="#,##0.00" Min="0"
                                             Label="VAT"
                                             @bind-Value=CurrentObject!.PurchaseTax For="@(() => CurrentObject.PurchaseTax)" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          Label="Finance Asset Code" Placeholder="Finance Asset Code" MaxLength="150"
                                          @bind-Value=CurrentObject!.FinAssetCode For="@(() => CurrentObject.FinAssetCode)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudDatePicker ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-datepicker" Editable="true"
                                           AdornmentIcon="material-symbols-rounded/calendar_month" AdornmentColor=@Color.Primary
                                           Label="Warranty Expiry"
                                           @bind-Date=@CurrentObject.ExpiryDate DateFormat="dd-MMM-yyyy" For="@(() => CurrentObject.ExpiryDate)" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudDatePicker ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-datepicker" Editable="true"
                                           AdornmentIcon="material-symbols-rounded/calendar_month" AdornmentColor=@Color.Primary
                                           Label="End Date"
                                           @bind-Date=@CurrentObject.EndDate DateFormat="dd-MMM-yyyy" For="@(() => CurrentObject.EndDate)" />
                        </MudItem>
                        <MudItem xs="3">
                            <MudComboBox ReadOnly=@IsViewMode Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-combo-box" PopoverClass="pru-ui-combo-box-popover" Editable="true" Variant="Variant.Text" SearchBox="true" Strict="true" autocomplete="new-password"
                                         Label="Vendor/Supplier" T="string"
                                         @bind-Value="@CurrentObject.VendorID" For="@(() => CurrentObject.VendorID)"
                                         ToStringFunc="@(e => string.IsNullOrEmpty(e) || !_vendorList.Any() ? "" : _vendorList.Single<DropdownSelectItem>(x => x.Key == e)?.Value)">
                                <ChildContent>
                                    @foreach (var vendor in _vendorList)
                                    {
                                        <MudComboBoxItem T="string" Value="@vendor.Key" Text="@vendor.Value">@vendor.Value</MudComboBoxItem>
                                    }
                                </ChildContent>
                            </MudComboBox>
                        </MudItem>
                        @* ================================================================================================================================== *@
                        <MudItem xs="12">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          Label="Usage Purpose" MaxLength="255" MaxLines="25" Lines="4"
                                          @bind-Value=CurrentObject!.CurrentUsagePurpose For="@(() => CurrentObject.CurrentUsagePurpose)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        <MudItem xs="12">
                            <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                          Label="Remark" MaxLength="255" MaxLines="25" Lines="4"
                                          @bind-Value=CurrentObject!.Remark For="@(() => CurrentObject.Remark)" OnlyValidateIfDirty="true" />
                        </MudItem>
                        @if (CurrentObject.ServerInfo != null)
                        {
                            <MudItem xs="2">
                                <MudSelect ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-select" 
                                    Label="Environment" 
                                    T="string" @bind-Value=CurrentObject!.ServerInfo.Env For="@(() => CurrentObject!.ServerInfo.Env)" OnlyValidateIfDirty="true">
                                    @foreach (string env in _envList)
                                    {
                                        <MudSelectItem Value=@env >@env</MudSelectItem>
                                    }
                                </MudSelect>
                            </MudItem>
                            <MudItem xs="3">
                                <MudSelect ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-select" 
                                Label="Zone"
                                           T="string" @bind-Value=CurrentObject!.ServerInfo.ZoneType For="@(() => CurrentObject!.ServerInfo.ZoneType)" OnlyValidateIfDirty="true">
                                
                                    @foreach (string zone in _zoneList)
                                    {
                                        <MudSelectItem Value=@zone>@zone</MudSelectItem>
                                    }
                                </MudSelect>
                            </MudItem>
                            <MudItem xs="3">
                                <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                              Label="Application"
                                              @bind-Value=CurrentObject!.ServerInfo.AppName For="@(() => CurrentObject.ServerInfo.AppName)" OnlyValidateIfDirty="true" />
                            </MudItem>
                            <MudItem xs="4">
                                <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                              Label="Owner"
                                              @bind-Value=CurrentObject!.ServerInfo.OwnerName For="@(() => CurrentObject.ServerInfo.OwnerName)" OnlyValidateIfDirty="true" />
                            </MudItem>
                            <MudItem xs="2">
                                <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                              Label="Operating System"
                                              @bind-Value=CurrentObject!.ServerInfo.OS For="@(() => CurrentObject.ServerInfo.OS)" OnlyValidateIfDirty="true" />
                            </MudItem>
                            <MudItem xs="3">
                                <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                              Mask="ipv4Mask" HelperText="@ipv4Mask.Mask"
                                              Label="IP Address"
                                              @bind-Value=CurrentObject!.ServerInfo.IPAddr For="@(() => CurrentObject.ServerInfo.IPAddr)" OnlyValidateIfDirty="true" />
                            </MudItem>
                            <MudItem xs="3">
                                <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                              Label="Domain Name"
                                              @bind-Value=CurrentObject!.ServerInfo.Domain For="@(() => CurrentObject.ServerInfo.Domain)" OnlyValidateIfDirty="true" />
                            </MudItem>
                            <MudItem xs="2">
                                <MudSwitchM3 ReadOnly=@IsViewMode Class="pru-mud-switch" Color="@(CurrentObject!.ServerInfo.IsActive ? Color.Success : Color.Secondary)"
                                             ThumbIcon="@Icons.Material.Rounded.Check" ThumbOffIcon="@Icons.Material.Rounded.Close" Size="Size.Small" Label="Active?"
                                             @bind-Value="CurrentObject!.ServerInfo.IsActive" For="@(() => CurrentObject.ServerInfo.IsActive)" OnlyValidateIfDirty="true" />
                            </MudItem>
                            <MudItem xs="2">
                                <MudSwitchM3 ReadOnly=@IsViewMode Class="pru-mud-switch" Color="@(CurrentObject!.ServerInfo.SCCMClientInd ? Color.Success : Color.Secondary)"
                                             ThumbIcon="@Icons.Material.Rounded.Check" ThumbOffIcon="@Icons.Material.Rounded.Close" Size="Size.Small" Label="SCCM Client"
                                             @bind-Value="CurrentObject!.ServerInfo.SCCMClientInd" For="@(() => CurrentObject.ServerInfo.SCCMClientInd)" OnlyValidateIfDirty="true" />
                            </MudItem>
                            <MudItem xs="6">
                                <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                              Label="Usage Purpose" MaxLength="255" MaxLines="25" Lines="4"
                                              @bind-Value=CurrentObject!.ServerInfo.UsagePurpose For="@(() => CurrentObject.ServerInfo.UsagePurpose)" OnlyValidateIfDirty="true" />
                            </MudItem>
                            <MudItem xs="6">
                                <MudTextField ReadOnly="@IsViewMode" Clearable="true" ShrinkLabel="true" FullWidth="true" Class="pru-mud-form-field bordered"
                                              Label="Server Remark" MaxLength="255" MaxLines="25" Lines="4"
                                              @bind-Value=CurrentObject!.ServerInfo.Remark For="@(() => CurrentObject.ServerInfo.Remark)" OnlyValidateIfDirty="true" />
                            </MudItem>
                        }
                        @if (CurrentEditContext.GetValidationMessages().Any() || InvalidMsgList.Count > 0)
                        {
                            <MudItem xs="12" Class="pt-10">
                                @foreach (string msg in CurrentEditContext.GetValidationMessages())
                                {
                                    <MudAlert Variant="Variant.Outlined" Severity="Severity.Warning" Dense="true" Icon="material-symbols-rounded/warning" Class="pru-alert-validation mt-2">@msg</MudAlert>
                                }
                                @foreach (string key in InvalidMsgList.Keys)
                                {
                                    <MudAlert Variant="Variant.Outlined" Severity="Severity.Warning" Dense="true" Icon="material-symbols-rounded/warning" Class="pru-alert-validation mt-2">@InvalidMsgList[key]</MudAlert>
                                }
                            </MudItem>
                        }
                    </MudGrid>
                    @if (Id > 0)
                    {
                        <MudStack Row="true" Class="px-2 py-1" AlignItems="AlignItems.Center" Spacing="1" Style="position:absolute; bottom:0; left:0; right:0; background-color:var(--pru-red-tw-50)">
                            <MudText Typo="Typo.body1" Style="font-size:8pt; color:var(--pru-gray-default)">Created By</MudText>
                            <MudText Typo="Typo.body1" Style="font-size:8pt; color:var(--pru-red-default)">@CurrentObject.CreatedUser</MudText>
                            <MudText Typo="Typo.body1" Style="font-size:8pt; color:var(--pru-gray-default)">on</MudText>
                            <MudText Typo="Typo.body1" Style="font-size:8pt; color:var(--pru-red-default)">@(CurrentObject.CreatedDateTime.HasValue? CurrentObject.CreatedDateTime!.Value.ToString("dd-MMM-yyyy hh:mm:ss tt") : " - ")</MudText>
                            <MudText Typo="Typo.body1" Style="font-size:8pt; color:var(--pru-gray-default)"> | Last Modified By</MudText>
                            <MudText Typo="Typo.body1" Style="font-size:8pt; color:var(--pru-red-default)">@CurrentObject.ModifiedUser</MudText>
                            <MudText Typo="Typo.body1" Style="font-size:8pt; color:var(--pru-gray-default)">on</MudText>
                            <MudText Typo="Typo.body1" Style="font-size:8pt; color:var(--pru-red-default)">@(CurrentObject.ModifiedDateTime.HasValue? CurrentObject.ModifiedDateTime!.Value.ToString("dd-MMM-yyyy hh:mm:ss tt") : " - ")</MudText>
                        </MudStack>
                    }
                </MudPaper>
            </MudTabPanel>
            <MudTabPanel Text="History" Icon="material-symbols-rounded/history" Class="pru-mud-tab-panel" Style="min-width:120px">
                <MudPaper Class="px-4 pt-4 pb-5 overflow-y-auto" Height="calc(100vh - 210px)" Width="100%" Elevation="0">
                    <MudStack Spacing="2" Justify=Justify.FlexStart >
                        <MudStack Row="true" Class="px-4 py-2" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween" Style="background-color:var(--pru-gray-tw-100)">
                            <MudText Typo="Typo.h5" Style="font-size:20px">Asset Audit History</MudText>
                            @if (!IsViewMode)
                            {
                                <MudButton StartIcon="material-symbols-rounded/add_circle" Size="Size.Small" Color="Color.Info" Variant="@Variant.Filled" DropShadow="false" Class="pru-btn-base in-pg-action"
                                           Disabled=@(_tempItemToAdd != null) OnClick="AddItem" FullWidth="false">
                                    Add Audit Trail
                                </MudButton>
                            }
                        </MudStack>

                        <MudDataGrid Class="pru-mud-datagrid mt-2" Dense="true" Hover="true" FixedHeader="true" Striped="true" ReadOnly=@IsViewMode Elevation="0"
                                     StartedEditingItem="@StartedEditingItem" CanceledEditingItem="@CanceledEditingItem" CommittedItemChanges="@CommittedItemChanges"
                                     EditTrigger="DataGridEditTrigger.Manual" EditMode="DataGridEditMode.Form" EditDialogOptions=@(new (){ BackgroundClass="pru-mud-datagrid-edit-diag-bg", BackdropClick=false, MaxWidth=MaxWidth.Medium, FullWidth=true }) ColumnResizeMode="ResizeMode.Container"
                                     @ref=@_auditTrailDataGrid T="ITAssetAuditTrail" Items="CurrentObject!.AuditTrails">
                            <Columns>
                                <PropertyColumn Property="x => x.RequestDate" Title="Request Date" Format="dd-MMM-yyyy" HeaderClass="pru-mud-datagrid-hdr cruc-pg-items" CellClass="pru-mud-datagrid-cell" Context="i">
                                    <EditTemplate>
                                        <MudDatePicker ReadOnly=@IsViewMode Clearable="true" ShrinkLabel="true" Editable="true" Class="pru-mud-form-field bordered pru-ui-datepicker" Required="true"
                                                       AdornmentIcon="material-symbols-rounded/calendar_month" AdornmentColor=@Color.Primary
                                                       Label="Request Date" DateFormat="dd-MMM-yyyy"
                                                       @bind-Date=@i.Item.RequestDate For="@(() => i.Item.RequestDate)" />
                                    </EditTemplate>
                                </PropertyColumn>
                                <PropertyColumn Property="x => x.EffectiveDate" Title="Effective Date" Format="dd-MMM-yyyy" HeaderClass="pru-mud-datagrid-hdr cruc-pg-items" CellClass="pru-mud-datagrid-cell" Context="i">
                                    <EditTemplate>
                                        <MudStack Row="true" Spacing="2">
                                            <MudDatePicker ReadOnly=@IsViewMode Clearable="true" ShrinkLabel="true" Editable="true" Class="pru-mud-form-field bordered pru-ui-datepicker"
                                                           AdornmentIcon="material-symbols-rounded/calendar_month" AdornmentColor=@Color.Primary
                                                           Label="Effecitve Date Date" DateFormat="dd-MMM-yyyy"
                                                           @bind-Date=@i.Item.EffectiveDate For="@(() => i.Item.EffectiveDate)" />
                                            <MudDatePicker ReadOnly=@IsViewMode Clearable="true" ShrinkLabel="true" Editable="true" Class="pru-mud-form-field bordered pru-ui-datepicker"
                                                           AdornmentIcon="material-symbols-rounded/calendar_month" AdornmentColor=@Color.Primary
                                                           Label="Till Date" DateFormat="dd-MMM-yyyy"
                                                           @bind-Date=@i.Item.EffTillDate For="@(() => i.Item.EffTillDate)" />
                                        </MudStack>
                                    </EditTemplate>
                                </PropertyColumn>
                                <PropertyColumn Property="x => x.ActionDesc" Title="Action" HeaderClass="pru-mud-datagrid-hdr cruc-pg-items" CellClass="pru-mud-datagrid-cell" Context="i" Sortable="false">
                                    <EditTemplate>
                                        <MudStack Row="true" Spacing="2">
                                            <MudTextField ReadOnly=@IsViewMode Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered" Required="true"
                                                          Label="Action"
                                                          @bind-Value=i.Item.ActionDesc For="@(() => i.Item.ActionDesc)" OnlyValidateIfDirty="true" MaxLength="255" />
                                            <MudAutocomplete Readonly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-autocomplete" FullWidth="true"
                                                             CoerceText="true" CoerceValue="true" SearchFunc="SearchActionBy"
                                                             Label="Action By" T="string"
                                                             @bind-Value=i.Item.ActionUser For="@(() => i.Item.ActionUser)" />
                                        </MudStack>
                                    </EditTemplate>
                                </PropertyColumn>
                                <PropertyColumn Property="x => x.ActionUser" Title="Action By" HeaderClass="pru-mud-datagrid-hdr cruc-pg-items" CellClass="pru-mud-datagrid-cell" Context="i" Sortable="false">
                                    <EditTemplate>
                                        @* <MudTextField ReadOnly=@IsViewMode Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered" Required="true"
                                                      Label="Action By" Placeholder="Name of employee" MaxLength="255"
                                                      @bind-Value=@i.Item.ActionUser For="@(() => i.Item.ActionUser)" OnlyValidateIfDirty="true" /> *@
                                    </EditTemplate>
                                </PropertyColumn>
                                <PropertyColumn Property="x => x.CurrentUserID" Title="User Staff ID" HeaderClass="pru-mud-datagrid-hdr cruc-pg-items" CellClass="pru-mud-datagrid-cell" Context="i" Sortable="false">
                                    <EditTemplate>
                                        <MudStack Row=true Spacing="2">
                                            <MudTextField ReadOnly=@IsViewMode Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered" Required="true"
                                                          Label="User Employee ID"
                                                          @bind-Value=i.Item.CurrentUserID For="@(() => i.Item.CurrentUserID)" OnlyValidateIfDirty="true"
                                                          MaxLength="255" />
                                            <MudTextField ReadOnly=@IsViewMode Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered" Required="true"
                                                          Label="User Name"
                                                          @bind-Value=i.Item.CurrentUserName For="@(() => i.Item.CurrentUserName)" OnlyValidateIfDirty="true"
                                                          MaxLength="255" />
                                        </MudStack>
                                    </EditTemplate>
                                </PropertyColumn>
                                <PropertyColumn Property="x => x.CurrentUserName" Title="User Name" HeaderClass="pru-mud-datagrid-hdr cruc-pg-items" CellClass="pru-mud-datagrid-cell" Context="i" Sortable="false">
                                    <EditTemplate>
                                        @* <MudTextField ReadOnly=@IsViewMode Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered"
                                                      Label="User Name" MaxLength="255"
                                                      @bind-Value=i.Item.CurrentUserName For="@(() => i.Item.CurrentUserName)" OnlyValidateIfDirty="true" /> *@
                                    </EditTemplate>
                                </PropertyColumn>
                                <PropertyColumn Property="x => x.CurrentUserFunc" Title="Function" HeaderClass="pru-mud-datagrid-hdr cruc-pg-items" CellClass="pru-mud-datagrid-cell" Context="i" Sortable="false">
                                    <EditTemplate>
                                        <MudStack Row=true Spacing="2" AlignItems="AlignItems.Start" Justify="Justify.FlexStart" StretchItems="StretchItems.All">
                                            <MudAutocomplete Readonly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-autocomplete" FullWidth="true"
                                                             CoerceText="true" CoerceValue="true" SearchFunc="SearchFunc"
                                                             Label="Function" T="string"
                                                             @bind-Value=i.Item.CurrentUserFunc For="@(() => i.Item.CurrentUserFunc)" />
                                            <MudAutocomplete Readonly="@IsViewMode" Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered pru-ui-autocomplete" FullWidth="true"
                                                             CoerceText="true" CoerceValue="true" SearchFunc="SearchDept"
                                                             Label="Department" T="string"
                                                             @bind-Value=i.Item.CurrentUserDept For="@(() => i.Item.CurrentUserDept)" />
                                        </MudStack>
                                    </EditTemplate>
                                </PropertyColumn>
                                <PropertyColumn Property="x => x.CurrentUserDept" Title="Department" HeaderClass="pru-mud-datagrid-hdr cruc-pg-items" CellClass="pru-mud-datagrid-cell" Context="i" Sortable="false">
                                    <EditTemplate>
                                        
                                    </EditTemplate>
                                </PropertyColumn>
                                <PropertyColumn Property="x => x.Approver" Title="Approver" HeaderClass="pru-mud-datagrid-hdr cruc-pg-items" CellClass="pru-mud-datagrid-cell" Context="i" Sortable="false">
                                    <EditTemplate>

                                    </EditTemplate>
                                </PropertyColumn>
                                <PropertyColumn Property="x => x.Remark" Title="Remark" HeaderClass="pru-mud-datagrid-hdr cruc-pg-items" CellClass="pru-mud-datagrid-cell" Context="i" Sortable="false">
                                    <EditTemplate>
                                        <MudTextField ReadOnly=@IsViewMode Clearable="true" ShrinkLabel="true" Class="pru-mud-form-field bordered" 
                                            Label="Remark" MaxLines="25" Lines=4 MaxLength="1000" 
                                                      @bind-Value=i.Item.Remark For="@(() => i.Item.Remark)" OnlyValidateIfDirty="true" />
                                    </EditTemplate>
                                </PropertyColumn>
                                <TemplateColumn Hidden=@IsViewMode Title="Action"
                                                HeaderClass="pru-mud-datagrid-hdr cruc-pg-items" CellClass="pru-mud-datagrid-cell" Context="i"
                                                HeaderStyle="width:80px">
                                    <CellTemplate>
                                        <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Edit" OnClick="@i.Actions.StartEditingItemAsync" />
                                        <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Delete" Color="Color.Error" OnClick="@(() => RemoveItem(i.Item))" />
                                    </CellTemplate>
                                </TemplateColumn>
                            </Columns>
                        </MudDataGrid>
                    </MudStack>
                </MudPaper>
            </MudTabPanel>
        </MudTabs>
    </EditForm>
}


@code {
    #region UI PARAM
    IEnumerable<DropdownSelectItem> _assetTypeList = AssetTypes.GetForDropdownList();
    IEnumerable<DropdownSelectItem> _assetStateList = AssetStates.GetForDropdownList();
    IEnumerable<DropdownSelectItem> _assetLifeCycleList = AssetLifeCycleStatuses.GetForDropdownList();
    IEnumerable<DropdownSelectItem> _categoryList = Enumerable.Empty<DropdownSelectItem>();
    IEnumerable<DropdownSelectItem> _subCategoryList = Enumerable.Empty<DropdownSelectItem>();
    IEnumerable<DropdownSelectItem> _vendorList = Enumerable.Empty<DropdownSelectItem>();
    List<DropdownSelectItem> _employeeList = [];
    ITAssetAuditTrail? _tempItemToAdd;
    MudDataGrid<ITAssetAuditTrail> _auditTrailDataGrid = new();
    IEnumerable<string> _envList = ["DEV", "UAT", "PRD", "SIT"];
    IEnumerable<string> _zoneList = ["Azure", "On-Prem"];
    IEnumerable<string> _deptList = PruDepartments.GetLatest();
    IEnumerable<string> _funcList = [];

    DropdownSelectItem? _requestor;
    DropdownSelectItem? _currentUser;

    PatternMask ipMask = new PatternMask("###.###.###.###")
        {
            MaskChars = new[] { new MaskChar('#', @"[0-9]") }
        };

    IMask ipv4Mask = RegexMask.IPv4();

    Dictionary<string, string> _statusCssClassList = new()
        {
            { "", "" },
            { AssetLifeCycleStatuses.IN_STOCK, "status-chip-success-light" },
            { AssetLifeCycleStatuses.IN_USE, "status-chip-success-light" },
            { AssetLifeCycleStatuses.WRITTEN_OFF, "status-chip-obsolete-light" },
            { AssetLifeCycleStatuses.PENDING_WRITE_OFF, "status-chip-pending-light" },
            { AssetLifeCycleStatuses.PENDING_TERMINATION, "status-chip-pending-light" },
        };

    Dictionary<string, string> _stateCssClassList = new()
    {
        { "", "" },
        { AssetStates.BRAND_NEW, "status-chip-success-light" },
        { AssetStates.USED_GOOD, "status-chip-success-light" },
        { AssetStates.USED_POOR, "status-chip-obsolete-light" },
        { AssetStates.USED_ESR, "status-chip-pending-light" },
        { AssetStates.EOL, "status-chip-obsolete-light" },
        { AssetStates.BROKEN_UNREPAIRABLE, "status-chip-pending-light" },
        { AssetStates.NA, "status-chip-pending-light" }
    };

    IEnumerable<string> _esuCwsLilst = [
        "Chanraksmey Soth",
        "Savorng Chhorm",
        "Chhinlong Horn",
        "Hongseng Kheng"
    ];
    #endregion

    #region PAGE LIFECYCLE FUNCTIONS
    public override Task SetParametersAsync(ParameterView parameters)
    {
        UrlPrefix = "/itasset/hardware";

        return base.SetParametersAsync(parameters);
    }

    protected override async Task OnInitializedAsync()
    {
        switch(CRUCMode)
        {
            case CRUCModes.READ:
                {
                    CurrentObject = await Uow.ITAssets.GetFullAsync(Id);
                    IsViewMode = true;
                }
                break;
            case CRUCModes.CREATE:
                {
                    CurrentObject = new();
                    CurrentObject!.AssetType = AssetTypes.Hardware;
                }
                break;
            case CRUCModes.UPDATE:
                CurrentObject = await Uow.ITAssets.GetFullAsync(Id);
                break;
            case CRUCModes.CLONE:
                {
                    var tempObj = await Uow.ITAssets.GetAsync(Id);
                    CurrentObject = tempObj.DeepClone();
                    CurrentObject!.Id = 0;
                    CurrentObject!.ObjectCode = String.Empty;
                    CurrentObject!.AssetType = AssetTypes.Hardware;
                } break;
        }

        CurrentEditContext = new EditContext(CurrentObject!);

        HeaderTitle = ObjectDisplayName;

        if (CurrentObject != null)
            await PopulateUIControls();
    }
    #endregion

    #region UI FUNCTIONS
    private async Task OnAssetTypeChanged(string assetType)
    {
        CurrentObject!.AssetType = assetType;

        if (!string.IsNullOrEmpty(assetType))
        {
            CurrentObject!.CategoryCode = null;
            CurrentObject!.CategoryName = null;
            CurrentObject!.SubCategory = null;
            _categoryList = await Uow.ITAssetCategories.GetForDropdownAsync(assetType, string.Empty);
        }
        else
        {
            CurrentObject!.CategoryCode = null;
            CurrentObject!.CategoryName = null;
            CurrentObject!.SubCategory = null;
            _categoryList = Enumerable.Empty<DropdownSelectItem>();
        }
    }

    private async Task OnCategoryChanged(string categoryCode)
    {
        if (!string.IsNullOrEmpty(categoryCode))
        {
            CurrentObject!.CategoryCode = categoryCode;
            CurrentObject!.CategoryName = _categoryList.FirstOrDefault(x => x.Key == categoryCode)?.Value;
            CurrentObject!.SubCategory = null;
            _subCategoryList = await Uow.ITAssetCategories.GetForDropdownAsync(CurrentObject.AssetType!, categoryCode);

            if (categoryCode == "SERVER")
            {
                if (CurrentObject!.ServerInfo == null)
                    CurrentObject!.ServerInfo = new();

                CurrentObject!.ServerInfo.IsDeleted = false;
            }
            else if (CurrentObject!.ServerInfo != null)
            {
                if (CurrentObject!.ServerInfo.Id == 0)
                    CurrentObject!.ServerInfo = null;
                else
                    CurrentObject!.ServerInfo.IsDeleted = true;
            }
        }
        else
        {
            CurrentObject!.CategoryCode = null;
            CurrentObject!.CategoryName = null;
            CurrentObject!.SubCategory = null;

            if (CurrentObject!.ServerInfo != null && CurrentObject!.ServerInfo.Id == 0)
            {
                CurrentObject!.ServerInfo = null;
            }

            _categoryList = Enumerable.Empty<DropdownSelectItem>();
        }
    }

    private async Task OnAssetStateClicked()
    {
        ObjectStateTransitionDetail objStd = new();
        objStd.CurrentState = CurrentObject!.AssetState;
        objStd.CurrentStateText = CurrentObject!.AssetStateText;
        objStd.ObjectClassName = CurrentObject.GetType().Name;
        objStd.ObjectFieldName = nameof(CurrentObject.AssetState);
        var diagParam = new DialogParameters<ObjectStateTransitDiag>();
        diagParam.Add(x => x.TransitionDetail, objStd);
        var diag = await MudDiagSvc.ShowAsync<ObjectStateTransitDiag>();
        var result = await diag.Result;

        if (!result!.Canceled)
        {

        }
    }

    private async Task OnLifeCycleStatusClicked()
    {
        ObjectStateTransitionDetail objStd = new();
        objStd.CurrentState = CurrentObject!.LifeCycleStatus;
        objStd.CurrentStateText = CurrentObject!.LifeCycleStatusText;
        objStd.ObjectClassName = CurrentObject.GetType().Name;
        objStd.ObjectFieldName = nameof(CurrentObject.LifeCycleStatus);

        var diagParam = new DialogParameters<ObjectStateTransitDiag>();
        diagParam.Add(x => x.TransitionDetail, objStd);

        var diag = await MudDiagSvc.ShowAsync<ObjectStateTransitDiag>("Update Life Cycle Status", diagParam);
        var result = await diag.Result;

        if (!result!.Canceled)
        {

        }
    }

    void AddItem()
    {
        _tempItemToAdd = new ITAssetAuditTrail();
        CurrentObject!.AuditTrails.Add(_tempItemToAdd);
        _auditTrailDataGrid.SetEditingItemAsync(_tempItemToAdd);
    }

    void RemoveItem(ITAssetAuditTrail i)
    {
        DateTime dateToRemove = i.RequestDate!.Value;
        string actionToRemove = i.ActionDesc!;

        if (i.Id > 0)
        {
            //#TODO# NOT YET IMPLEMENTED
        }
        else
        {
            CurrentObject!.AuditTrails.Remove(i);
        }
    }

    void StartedEditingItem(ITAssetAuditTrail item)
    {

    }

    void CanceledEditingItem(ITAssetAuditTrail item)
    {
        if (_tempItemToAdd != null)
        {
            // CurrentObject!.AuditTrails.RemoveAt(CurrentObject!.AuditTrails.FindIndex(x => x.OrderNo == item.OrderNo));
            _tempItemToAdd = null;
        }
    }

    void CommittedItemChanges(ITAssetAuditTrail item)
    {
        _tempItemToAdd = null;
    }

    void OnRequestorValueChanged(DropdownSelectItem? item)
    {
        if (item is null)
        {
            _requestor = null;
            CurrentObject!.RequestUserID = null;
            CurrentObject!.RequestUserName = null;
        }
        else
        {
            _requestor = item;
            CurrentObject!.RequestUserID = item.Key;
            CurrentObject!.RequestUserName = item.Value;
        }
    }

    void OnCurrentUserValueChanged(DropdownSelectItem? item)
    {
        if (item is null)
        {
            _currentUser = null;
            CurrentObject!.CurrentUserID = null;
            CurrentObject!.CurrentUserName = null;
        }
        else
        {
            _currentUser = item;
            CurrentObject!.CurrentUserID = item.Key;
            CurrentObject!.CurrentUserName = item.Value;
        }
    }

    private async Task<IEnumerable<DropdownSelectItem>> SearchRequestor(string value, CancellationToken token)
    {
        // In real life use an asynchronous function for fetching data from an api.
        await Task.Delay(5, token);

        // if text is null or empty, show complete list
        if (string.IsNullOrEmpty(value))
        {
            return _employeeList.Take(50);
        }

        return _employeeList.Where(x => x.Value.Contains(value, StringComparison.InvariantCultureIgnoreCase) || x.Key == value).Take(50);
    }

    private async Task<IEnumerable<DropdownSelectItem>> SearchCurrentUser(string value, CancellationToken token)
    {
        // In real life use an asynchronous function for fetching data from an api.
        await Task.Delay(5, token);

        // if text is null or empty, show complete list
        if (string.IsNullOrEmpty(value))
        {
            return _employeeList.Take(50);
        }

        return _employeeList.Where(x => x.Value.Contains(value, StringComparison.InvariantCultureIgnoreCase) || x.Key == value).Take(50);
    }

    private async Task<IEnumerable<string>> SearchActionBy(string value, CancellationToken token)
    {
        // In real life use an asynchronous function for fetching data from an api.
        await Task.Delay(5, token);

        // if text is null or empty, show complete list
        if (string.IsNullOrEmpty(value))
        {
            return _esuCwsLilst;
        }

        return _esuCwsLilst.Where(x => x.Contains(value, StringComparison.InvariantCultureIgnoreCase));
    }

    private async Task<IEnumerable<string>> SearchFunc(string value, CancellationToken token)
    {
        // In real life use an asynchronous function for fetching data from an api.
        await Task.Delay(5, token);

        // if text is null or empty, show complete list
        if (string.IsNullOrEmpty(value))
        {
            return _funcList;
        }

        return _funcList.Where(x => x.Contains(value, StringComparison.InvariantCultureIgnoreCase));
    }

    private async Task<IEnumerable<string>> SearchDept(string value, CancellationToken token)
    {
        // In real life use an asynchronous function for fetching data from an api.
        await Task.Delay(5, token);

        // if text is null or empty, show complete list
        if (string.IsNullOrEmpty(value))
        {
            return _deptList;
        }

        return _deptList.Where(x => x.Contains(value, StringComparison.InvariantCultureIgnoreCase));
    }
    #endregion

    #region UPDATE FUNCTIONS
    protected override async Task PreSaveProcessing()
    {
        CurrentObject!.ObjectCode = CurrentObject!.ObjectCode!.ToUpper();
        await Task.CompletedTask;
    }

    protected override async Task ValidatePreSave()
    {
        InvalidMsgList.Clear();

        bool isDuplicated = await Uow.ITAssets.IsDuplicateCodeAsync(CurrentObject!.Id, CurrentObject!.ObjectCode!);

        if (isDuplicated)
        {
            InvalidMsgList.Add("ObjectCode_Duplicate", $"Asset with ID='{CurrentObject.ObjectCode}' is already existed.");
        }
    }

    protected override async Task<bool> SaveAndCommitProcessing()
    {
        DateTime timestamp = DateTime.Now;

        // if (CurrentObject!.Id == 0)   //create
        // {
        //     CurrentObject!.CreatedUser = AuditTrailUser;
        //     CurrentObject!.ModifiedUser = AuditTrailUser;
        //     CurrentObject!.CreatedDateTime = timestamp;
        //     CurrentObject!.ModifiedDateTime = timestamp;

        //     int objId = await Uow.ITAssets.InsertAsync(CurrentObject!);

        //     if (objId > 0)
        //     {
        //         CurrentObject!.Id = objId;
        //         return true;
        //     }
        //     else
        //         return false;
        // }
        // else    // update
        // {
        //     CurrentObject!.ModifiedUser = AuditTrailUser;
        //     CurrentObject!.ModifiedDateTime = DateTime.Now;

        //     bool isupdated = await Uow.ITAssets.UpdateAsync(CurrentObject!);
        //     return isupdated;
        // }

        if (CurrentObject!.Id == 0)
        {
            CurrentObject!.CreatedUser = AuditTrailUser;
            CurrentObject!.CreatedDateTime = timestamp;
        }

        CurrentObject!.ModifiedUser = AuditTrailUser;
        CurrentObject!.ModifiedDateTime = timestamp;

        int objId = await Uow.ITAssets.InsertOrUpdateFullAsync(CurrentObject!);
        return objId > 0;
    }
    #endregion

    #region INTERNAL FUNCTION
    private async Task PopulateUIControls()
    {
        _vendorList = await Uow.Vendors.GetForDropdownListAsync(PruLBUs.PCLA);
        _categoryList = await Uow.ITAssetCategories.GetForDropdownAsync(CurrentObject!.AssetType!);

        if (!string.IsNullOrEmpty(CurrentObject!.AssetType))
        {
            _categoryList = await Uow.ITAssetCategories.GetForDropdownAsync(CurrentObject!.AssetType);

            if (!string.IsNullOrEmpty(CurrentObject!.CategoryCode))
            {
                _subCategoryList = await Uow.ITAssetCategories.GetForDropdownAsync(CurrentObject!.AssetType, CurrentObject!.CategoryCode);
            }
        }

        _employeeList = (await Uow.Employees.GetActiveForDropdownAsync()).ToList();

        if (CurrentObject!.Requestor != null)
        {
            if (_employeeList.Count(x => x.Key == CurrentObject!.Requestor.EmpID) == 1)
            {
                _requestor = _employeeList.SingleOrDefault<DropdownSelectItem>(x => x.Key == CurrentObject!.Requestor.EmpID);
            }
            else
            {
                
            }
        }

        if (CurrentObject!.CurrentUser != null)
        {
            if (_employeeList.Count(x => x.Key == CurrentObject!.CurrentUser.EmpID) == 1)
            {
                _currentUser = _employeeList.SingleOrDefault<DropdownSelectItem>(x => x.Key == CurrentObject!.CurrentUser.EmpID);
            }
            else
            {

            }
        }
    }
    #endregion
}